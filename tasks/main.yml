---
- name: install go
  include_role:
    name: gantsign.golang
- name: install build-essential
  apt:
    name: build-essential
    update_cache: true
  become: true
- name: install git
  apt:
    name: git
    state: present
  become: true
- name: clone repository
  git:
    repo: https://github.com/chancoin-core/chancoin-cash.git
    dest: "{{ chancoin_install_path }}"
    accept_hostkey: yes
    version: "{{ chancoin_version }}"
- name: copy genesis json to server
  template:
    src: files/localchan.json
    dest: "{{ chancoin_install_path }}"
- name: make sure chancoin install path exists
  file:
    path: "{{ chancoin_install_path}}"
    state: directory
  become: true
- name: make all chancoin
  shell: ./run_make.sh
  args:
    chdir: "{{ chancoin_install_path }}"
- name: copy chancoin to path
  shell: cp build/bin/chancoin /usr/bin/chancoin
  become: true
  args:
    chdir: "{{ chancoin_install_path }}"
- name: init chain
  shell: chancoin init localchan.json
# TODO Copy address file if it exists
- name: create chancoin service unit
  template:
    src: templates/chancoin.service
    dest: /etc/systemd/system/chancoin.service
  become: true
- name: copy config file
  template:
    src: templates/config.toml
    dest: "{{chancoin_install_path}}/config.toml"
  become: true
- name: enable chancoin unit
  shell: systemctl enable chancoin
  become: true
- name: start chancoin service
  service:
    name: chancoin
    state: started
  become: true
